<nav class="flex items-center justify-between px-8 py-4 bg-white shadow-sm sticky top-0 z-50">
  <!-- Logo - visible on all screens -->
  <div class="flex items-center">
    <h1 class="text-2xl font-bold gradient-text">The Play</h1>
  </div>
  
  <!-- Desktop Navigation - hidden on mobile -->
  <div class="hidden md:flex items-center space-x-8">
    <a href="../../pages/app/index.html" class="font-medium text-gray-700 hover:text-purple-600">Home</a>
    <a href="#" class="font-medium text-gray-700 hover:text-purple-600">Discover</a>
    <a href="#" class="font-medium text-gray-700 hover:text-purple-600">Map</a>
    <a href="#" class="font-medium text-gray-700 hover:text-purple-600">Popular</a>
    <a href="../../pages/app/messages.html" class="relative font-medium text-gray-700 hover:text-purple-600">
      <i class="fas fa-envelope mr-1"></i> Messages
      <span id="unread-messages-badge" class="hidden absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center">0</span>
    </a>  
  </div>
  
  <!-- Desktop Search Bar - hidden on mobile -->
  <div class="hidden md:block relative mr-4">
    <form id="header-search-form" action="../../pages/app/search.html" method="get" class="flex items-center">
      <div class="relative w-64">
        <input 
          type="text" 
          name="q" 
          id="header-search-input"
          placeholder="Search events..." 
          class="w-full py-2 pl-10 pr-4 rounded-full bg-gray-100 border border-gray-300 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm"
          aria-label="Search events"
        >
        <div class="absolute left-3 top-2.5 text-gray-400">
          <i class="fas fa-search"></i>
        </div>
        <button 
          type="submit" 
          class="absolute right-3 top-2 text-gray-500 hover:text-purple-600 transition-colors"
          aria-label="Submit search"
        >
          <i class="fas fa-arrow-right"></i>
        </button>
      </div>
    </form>
  </div>
  
  <!-- Desktop Action Buttons - hidden on mobile -->
  <div class="hidden md:flex items-center space-x-4">
    <a href="../../pages/app/create-event.html" class="btn-primary">Create Event</a>
    <button id="logout-button" class="btn-secondary">Logout</button>
    <div class="w-10 h-10 rounded-full bg-gray-300 overflow-hidden">
      <img id="header-profile-pic" src="/api/placeholder/100/100" alt="Profile" class="w-full h-full object-cover">
    </div>
  </div>
  
  <!-- Mobile Control Buttons - visible only on mobile -->
  <div class="flex md:hidden items-center space-x-2">
    <!-- Mobile Search Button -->
    <button id="mobile-search-trigger" class="p-2 text-gray-600 hover:text-purple-600">
      <i class="fas fa-search text-lg"></i>
    </button>
    
    <!-- Mobile Menu Toggle Button -->
    <button id="mobile-menu-toggle" class="p-2 text-gray-600 hover:text-purple-600">
      <i class="fas fa-bars text-lg"></i>
    </button>
  </div>
</nav>

<!-- Mobile Menu (hidden by default) -->
<div id="mobile-menu" class="hidden md:hidden bg-white shadow-sm px-8 py-4 border-t border-gray-200">
  <div class="flex flex-col space-y-4">
    <a href="../../pages/app/index.html" class="font-medium text-gray-700 hover:text-purple-600 py-2">Home</a>
    <a href="#" class="font-medium text-gray-700 hover:text-purple-600 py-2">Discover</a>
    <a href="#" class="font-medium text-gray-700 hover:text-purple-600 py-2">Map</a>
    <a href="#" class="font-medium text-gray-700 hover:text-purple-600 py-2">Popular</a>
    <a href="../../pages/app/messages.html" class="relative font-medium text-gray-700 hover:text-purple-600 py-2">
      <i class="fas fa-envelope mr-1"></i> Messages
        <span id="mobile-unread-messages-badge" class="hidden absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center">0</span>
    </a>
    <div class="border-t border-gray-200 py-2"></div>
    <a href="../../pages/app/create-event.html" class="font-medium text-purple-600 hover:text-purple-700 py-2">Create Event</a>
    <button id="mobile-logout-button" class="font-medium text-red-600 hover:text-red-700 py-2 text-left">Logout</button>
  </div>
</div>

<!-- Mobile Search Overlay (hidden by default) -->
<div id="mobile-search-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
  <div class="flex items-center justify-center h-full px-4">
    <div class="bg-white w-full max-w-md rounded-lg p-4">
      <div class="flex justify-between items-center mb-4">
        <h3 class="text-lg font-semibold">Search Events</h3>
        <button id="close-mobile-search" class="text-gray-500 hover:text-gray-700">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <form action="../../pages/app/search.html" method="get">
        <div class="relative">
          <input 
            type="text" 
            name="q" 
            placeholder="Search events, venues, or categories" 
            class="w-full py-3 pl-10 pr-4 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent"
            aria-label="Search events in mobile view"
          >
          <div class="absolute left-3 top-3.5 text-gray-400">
            <i class="fas fa-search"></i>
          </div>
          <button 
            type="submit" 
            class="mt-3 w-full bg-purple-600 hover:bg-purple-700 text-white py-2 rounded-lg transition-colors"
          >
            Search
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Mobile Menu Toggle
    const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
    const mobileMenu = document.getElementById('mobile-menu');
    
    if (mobileMenuToggle && mobileMenu) {
      mobileMenuToggle.addEventListener('click', function() {
        mobileMenu.classList.toggle('hidden');
      });
    }
    
    // Mobile Search Overlay
    const mobileSearchTrigger = document.getElementById('mobile-search-trigger');
    const mobileSearchOverlay = document.getElementById('mobile-search-overlay');
    const closeMobileSearch = document.getElementById('close-mobile-search');
    
    if (mobileSearchTrigger && mobileSearchOverlay) {
      // Open mobile search overlay
      mobileSearchTrigger.addEventListener('click', function() {
        mobileSearchOverlay.classList.remove('hidden');
        document.body.style.overflow = 'hidden'; // Prevent scrolling while overlay is open
        
        // Focus on search input
        setTimeout(() => {
          const mobileSearchInput = mobileSearchOverlay.querySelector('input[name="q"]');
          if (mobileSearchInput) {
            mobileSearchInput.focus();
          }
        }, 100);
      });
      
      // Close mobile search overlay
      if (closeMobileSearch) {
        closeMobileSearch.addEventListener('click', function() {
          mobileSearchOverlay.classList.add('hidden');
          document.body.style.overflow = 'auto'; // Restore scrolling
        });
      }
      
      // Close when clicking outside the search box
      mobileSearchOverlay.addEventListener('click', function(e) {
        if (e.target === mobileSearchOverlay) {
          mobileSearchOverlay.classList.add('hidden');
          document.body.style.overflow = 'auto'; // Restore scrolling
        }
      });
    }
    
    // Header search form validation
    const headerSearchForm = document.getElementById('header-search-form');
    if (headerSearchForm) {
      headerSearchForm.addEventListener('submit', function(e) {
        const searchInput = headerSearchForm.querySelector('input[name="q"]');
        const query = searchInput.value.trim();
        
        // Prevent empty searches
        if (!query) {
          e.preventDefault();
          searchInput.focus();
        }
      });
    }
  });
</script>

<style>
  /* Include the gradient styles from the mockup */
  .gradient-text {
    background: linear-gradient(120deg, #6C63FF, #FF6B6B);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }
  
  .btn-primary {
    background: linear-gradient(120deg, #6C63FF, #FF6B6B);
    color: white;
    border-radius: 8px;
    padding: 10px 20px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
  }
  
  .btn-secondary {
    background: #FF6B6B;
    color: white;
    border-radius: 8px;
    padding: 10px 20px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
  }
  
  .btn-primary:hover, .btn-secondary:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(108, 99, 255, 0.3);
  }
</style>

<script>
  // Simple direct logout function that works without modules
  document.getElementById('logout-button').addEventListener('click', function() {
    console.log("Logout button clicked");
    
    // First try the modular approach
    try {
      import('../../scripts/auth/authentication.js')
        .then(module => {
          const authentication = module.default;
          return authentication.logOut();
        })
        .then(result => {
          if (result.success) {
            window.location.href = "../../pages/auth/login.html";
          } else {
            alert("Error logging out: " + result.error);
          }
        })
        .catch(error => {
          // Fall back to direct Firebase method if modular approach fails
          firebaseLogout();
        });
    } catch (error) {
      // Fall back to direct Firebase method
      firebaseLogout();
    }
    
    // Direct Firebase logout as fallback
    function firebaseLogout() {
      if (typeof firebase !== 'undefined' && firebase.auth) {
        firebase.auth().signOut().then(() => {
          console.log("Logged out successfully using direct Firebase method");
          alert("You have been logged out.");
          window.location.href = "../../pages/auth/login.html";
        }).catch((error) => {
          console.error("Error signing out:", error);
          alert("Error logging out: " + error.message);
        });
      } else {
        alert("Firebase is not initialized. Cannot log out.");
      }
    }
  });
  
  // Set user profile if available
  document.addEventListener('DOMContentLoaded', function() {
    if (typeof firebase !== 'undefined' && firebase.auth) {
      const currentUser = firebase.auth().currentUser;
      if (currentUser && currentUser.photoURL) {
        const profilePic = document.getElementById('header-profile-pic');
        if (profilePic) {
          profilePic.src = currentUser.photoURL;
        }
      }
    }
  });

// Check unread messages function
  async function checkUnreadMessages() {
    if (typeof firebase === 'undefined' || !firebase.auth().currentUser) return;
    
    try {
      // Import chat service
      const { default: chatService } = await import('../../scripts/services/chat-service.js');
      
      // Get unread count
      const unreadCount = await chatService.getUnreadMessagesCount();
      
      // Update badges
      const badges = [
        document.getElementById('unread-messages-badge'),
        document.getElementById('mobile-unread-messages-badge')
      ];
      
      badges.forEach(badge => {
        if (badge) {
          if (unreadCount > 0) {
            badge.textContent = unreadCount > 9 ? '9+' : unreadCount;
            badge.classList.remove('hidden');
          } else {
            badge.classList.add('hidden');
          }
        }
      });
    } catch (error) {
      console.error('Error checking unread messages:', error);
    }
  }
  
  // Check for unread messages when the page loads and the user is authenticated
  document.addEventListener('DOMContentLoaded', function() {
    if (typeof firebase !== 'undefined' && firebase.auth) {
      firebase.auth().onAuthStateChanged(user => {
        if (user) {
          // Update profile picture
          const profilePic = document.getElementById('header-profile-pic');
          if (profilePic && user.photoURL) {
            profilePic.src = user.photoURL;
          }
          
          // Check for unread messages
          checkUnreadMessages();
          
          // Set up periodic check every minute
          setInterval(checkUnreadMessages, 60000);
        }
      });
    }
  });
</script>